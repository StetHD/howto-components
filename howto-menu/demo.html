<!doctype html>

<style>
  howto-menu {
    position: absolute;
    display: block;
    width: 10em;
  }

  [role="menuitem"] {
    display: block;
    width: 100%;
    padding: .2em .5em;
    border: 1px solid lightgrey;
  }

  howto-menu:not([opened]) {
    display: none;
  }
</style>

<div class="text">
   <button id="menu-btn">options</button>
   <howto-menu aria-labelledby="menu-btn">
     <span role="menuitem">first option</span>
     <span role="menuitem">second option</span>
     <span role="menuitem">other option</span>
     <span role="menuitem">yet another option</span>
   </howto-menu>
</div>

<script>
  var menu = document.querySelector('howto-menu');
  document.getElementById('menu-btn').addEventListener('click', e => {
    menu.opened = true;
  })
</script>


<script>
  (function() {
    // Loads a script asynchronously and returns a promise that resolves when
    // when the script has loaded.
    function loadScript(src) {
      return new Promise(resolve => {
        const s = document.createElement('script');
        s.onload = resolve;
        s.src = src;
        document.head.appendChild(s);
      });
    }

    // Sends a message to the parent window with the current size of document.
    // If this page is embedded in an iframe, the parent page has the choice
    // to adapt the size of the iframe to accommodate the contents.
    function sendSize() {
      if(window.parent === window) return;
      window.parent.postMessage(document.documentElement.getBoundingClientRect().height, '*');
    }

    // The parents window can query the iframe’s document size at any time by
    // sending any message.
    window.addEventListener('message', sendSize);

    window._loadJavaScript = _ => {
      const whenScriptsLoaded = [
        '../scripts/custom-elements.min.js',
        '../scripts/shadydom.min.js',
        'howto-menu.js',
      ].reduce((chain, src) =>
        chain.then(_ => loadScript(src)),
        Promise.resolve()
      );
      return whenScriptsLoaded
        .then(_ => customElements.whenDefined('howto-menu'))
        .then(_ => sendSize());
    };

    // If there’s a `nojs` in the URL’s query string, don’t load the elements,
    // somewhat emulating disabled JavaScript.
    if (!document.location.search.includes('nojs')) {
      _loadJavaScript();
    }

    // Hook up ResizeObserver for dynamic size adjustments
    loadScript('../scripts/resizeobserver.min.js')
      .then(_ => {
        const ResizeObserver =
          self.ResizeObserver || self.ResizeObserverPolyfill;
        const ro = new ResizeObserver(_ => sendSize());
        // One of them’s gotta be the right one, right?
        ro.observe(document.documentElement);
        ro.observe(document.body);
        ro.observe(document.scrollingElement);
      });

    // Send size after loading is done
    requestAnimationFrame(_ => sendSize());
  })();
</script>
</html>
